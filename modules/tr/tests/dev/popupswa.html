<!doctype html>
<html>
<head>
    <title>Reuters Insider</title>
    <script type="text/javascript" src="../../../../mwEmbedLoader.php"></script>
    <link rel="stylesheet" type="text/css" href="../../resources/newpopup.css" >
</head>


<body>
<div id="topContainer" >
    <div id="playerHeader">
        <div class="tr-top-logo">REUTERS&nbsp;<span class="tr-logo-sub">INSIDER</span></div>
    </div>
    <div id="topFunctions">
    </div>
    <div id="playerContainer">
        <div id="kPlayer" ></div>
    </div>
    <div id="captionsContainer"></div>
</div>
<script>
    //parse query string to an object
    var queryString = function () {
        var query_string = {};
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            // If first entry with this name
            if (typeof query_string[pair[0]] === "undefined") {
                query_string[pair[0]] = pair[1];
                // If second entry with this name
            } else if (typeof query_string[pair[0]] === "string") {
                var arr = [ query_string[pair[0]], pair[1] ];
                query_string[pair[0]] = arr;
                // If third or later entry with this name
            } else {
                query_string[pair[0]].push(pair[1]);
            }
        }
        return query_string;
    } ();

    //defaults TR

    var entryId = "";
    var partnerId = 27017;
    var uiconfId = 29277301 ; //this will come from KMS 27493391 28529602 29008071 29277301(TR)
    var clipsToShow = 3; //amount of videos to show in playlist
    var omniturePn = "";
    var omnitureEud = "";
    var omnitureUuid = "";
    var widgetType = "";
    var playlistId = "1_kvvdd4ar";
    var startFrom = 0;


    var hashStr = window.location.hash.substring(1);
    var jsonConfig = {};
    try {
        jsonConfig = JSON.parse(hashStr);
    } catch( e ) {
        kWidget.log('TR: Unable to parse JSON from location.hash');
    }

    partnerId = jsonConfig.pid;
    //playlistId = jsonConfig.cid;
    entryId = jsonConfig.mid;
    widgetType = jsonConfig.wtype;
    if(jsonConfig.startFrom){
        startFrom = jsonConfig.startFrom;
    }

    if(jsonConfig.uiconfId){
        uiconfId = jsonConfig.uiconfId;
    }
    if(jsonConfig.clipsToShow){
        clipsToShow = jsonConfig.clipsToShow;
    }
    //      example of override
    //      http://localhost/html5.kaltura/mwEmbed/modules/tr/tests/dev/popup.html?#{"pid":27017,"mid":"1_1611vudr","startFrom":0,"uuid":"omnitureUser","pn":"pmniturePn","bitrate":400,"eud":"omnitureEud","wtype":"omnitureWtype"}
    mw.setConfig('forceMobileHTML5', true);


    kWidget.embed({
        'targetId': 'kPlayer',
        'wid': '_'+partnerId,
        'uiconf_id' : uiconfId,
        'entry_id' : entryId,
        'flashvars': {
            'ks' : '',
            'locale' : 'jp',
            'autoPlay' : 'true',
            'confFilePath': '{libPath}/modules/tr/resources/trjson.json',
            'trTitle' : {
                "createTopBar" : false
            },
            "trTranscript": {
                "plugin": true,
                "targetId" : "captionsContainer",
                "responseProfile" : 12
            },
            "mediaProxy.mediaPlayFrom" : startFrom,

            "closedCaptions": {
                "plugin": true,
                "forceLoadLanguage": "en"
            },
            "share": {
                "plugin": true,
                "socialShareURL" : "{trControls.shareOutput}"
            },
            "trControls" : {
                "plugin" : true,
                "targetId" : "topFunctions"
            }
            ,'trPlaylistServices': {
                'plugin': true
            }
            ,'trSwa': {
                'plugin': true,
                'selectedTag' : 'tag1'
            }
            ,'playlistAPI': {
                'autoPlay' : 'true',
                'showControls': false,
                'includeHeader': false,
                'mediaItemHeight': 160,
                'renderWhenEmpty': true,
                'horizontalHeaderHeight' : 40,
                'templatePath': '../tr/templates/playlist.tmpl.html',
                'MinClips': 4
            }


        }
    });

</script>
</body>
</html>
