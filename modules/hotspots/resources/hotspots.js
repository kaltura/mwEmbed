!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("hotspots",[],t):"object"==typeof exports?exports.hotspots=t():(e.KalturaPlayer=e.KalturaPlayer||{},e.KalturaPlayer.plugins=e.KalturaPlayer.plugins||{},e.KalturaPlayer.plugins.hotspots=t())}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";n.r(t),n.d(t,"h",function(){return s}),n.d(t,"createElement",function(){return s}),n.d(t,"cloneElement",function(){return d}),n.d(t,"createRef",function(){return V}),n.d(t,"Component",function(){return R}),n.d(t,"render",function(){return I}),n.d(t,"rerender",function(){return g}),n.d(t,"options",function(){return i});var o=function(){},i={},r=[],a=[];function s(e,t){var n,s,l,u,p=a;for(u=arguments.length;u-- >2;)r.push(arguments[u]);for(t&&null!=t.children&&(r.length||r.push(t.children),delete t.children);r.length;)if((s=r.pop())&&void 0!==s.pop)for(u=s.length;u--;)r.push(s[u]);else"boolean"==typeof s&&(s=null),(l="function"!=typeof e)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(l=!1)),l&&n?p[p.length-1]+=s:p===a?p=[s]:p.push(s),n=l;var d=new o;return d.nodeName=e,d.children=p,d.attributes=null==t?void 0:t,d.key=null==t?void 0:t.key,void 0!==i.vnode&&i.vnode(d),d}function l(e,t){for(var n in t)e[n]=t[n];return e}function u(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}var p="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function d(e,t){return s(e.nodeName,l(l({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var c=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,h=[];function f(e){!e._dirty&&(e._dirty=!0)&&1==h.push(e)&&(i.debounceRendering||p)(g)}function g(){for(var e;e=h.pop();)e._dirty&&L(e)}function y(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function v(e){var t=l({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function m(e){var t=e.parentNode;t&&t.removeChild(e)}function b(e,t,n,o,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)u(n,null),u(o,e);else if("class"!==t||i)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var r in n)r in o||(e.style[r]="");for(var r in o)e.style[r]="number"==typeof o[r]&&!1===c.test(r)?o[r]+"px":o[r]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,_,a):e.removeEventListener(t,_,a),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!i&&t in e){try{e[t]=null==o?"":o}catch(e){}null!=o&&!1!==o||"spellcheck"==t||e.removeAttribute(t)}else{var s=i&&t!==(t=t.replace(/^xlink:?/,""));null==o||!1===o?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function _(e){return this._listeners[e.type](i.event&&i.event(e)||e)}var C=[],w=0,T=!1,S=!1;function x(){for(var e;e=C.shift();)i.afterMount&&i.afterMount(e),e.componentDidMount&&e.componentDidMount()}function P(e,t,n,o,i,r){w++||(T=null!=i&&void 0!==i.ownerSVGElement,S=null!=e&&!("__preactattr_"in e));var a=k(e,t,n,o,r);return i&&a.parentNode!==i&&i.appendChild(a),--w||(S=!1,r||x()),a}function k(e,t,n,o,i){var r=e,a=T;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(r=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(r,e),O(e,!0))),r.__preactattr_=!0,r;var s,l,u=t.nodeName;if("function"==typeof u)return function(e,t,n,o){var i=e&&e._component,r=i,a=e,s=i&&e._componentConstructor===t.nodeName,l=s,u=v(t);for(;i&&!l&&(i=i._parentComponent);)l=i.constructor===t.nodeName;i&&l&&(!o||i._component)?(N(i,u,3,n,o),e=i.base):(r&&!s&&(M(r),e=a=null),i=H(t.nodeName,u,n),e&&!i.nextBase&&(i.nextBase=e,a=null),N(i,u,1,n,o),e=i.base,a&&e!==a&&(a._component=null,O(a,!1)));return e}(e,t,n,o);if(T="svg"===u||"foreignObject"!==u&&T,u=String(u),(!e||!y(e,u))&&(s=u,(l=T?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s)).normalizedNodeName=s,r=l,e)){for(;e.firstChild;)r.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(r,e),O(e,!0)}var p=r.firstChild,d=r.__preactattr_,c=t.children;if(null==d){d=r.__preactattr_={};for(var h=r.attributes,f=h.length;f--;)d[h[f].name]=h[f].value}return!S&&c&&1===c.length&&"string"==typeof c[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=c[0]&&(p.nodeValue=c[0]):(c&&c.length||null!=p)&&function(e,t,n,o,i){var r,a,s,l,u,p=e.childNodes,d=[],c={},h=0,f=0,g=p.length,v=0,b=t?t.length:0;if(0!==g)for(var _=0;_<g;_++){var C=p[_],w=C.__preactattr_,T=b&&w?C._component?C._component.__key:w.key:null;null!=T?(h++,c[T]=C):(w||(void 0!==C.splitText?!i||C.nodeValue.trim():i))&&(d[v++]=C)}if(0!==b)for(var _=0;_<b;_++){l=t[_],u=null;var T=l.key;if(null!=T)h&&void 0!==c[T]&&(u=c[T],c[T]=void 0,h--);else if(f<v)for(r=f;r<v;r++)if(void 0!==d[r]&&(S=a=d[r],P=i,"string"==typeof(x=l)||"number"==typeof x?void 0!==S.splitText:"string"==typeof x.nodeName?!S._componentConstructor&&y(S,x.nodeName):P||S._componentConstructor===x.nodeName)){u=a,d[r]=void 0,r===v-1&&v--,r===f&&f++;break}u=k(u,l,n,o),s=p[_],u&&u!==e&&u!==s&&(null==s?e.appendChild(u):u===s.nextSibling?m(s):e.insertBefore(u,s))}var S,x,P;if(h)for(var _ in c)void 0!==c[_]&&O(c[_],!1);for(;f<=v;)void 0!==(u=d[v--])&&O(u,!1)}(r,c,n,o,S||null!=d.dangerouslySetInnerHTML),function(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||b(e,o,n[o],n[o]=void 0,T);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||b(e,o,n[o],n[o]=t[o],T)}(r,t.attributes,d),T=a,r}function O(e,t){var n=e._component;n?M(n):(null!=e.__preactattr_&&u(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||m(e),z(e))}function z(e){for(e=e.lastChild;e;){var t=e.previousSibling;O(e,!0),e=t}}var j=[];function H(e,t,n){var o,i=j.length;for(e.prototype&&e.prototype.render?(o=new e(t,n),R.call(o,t,n)):((o=new R(t,n)).constructor=e,o.render=E);i--;)if(j[i].constructor===e)return o.nextBase=j[i].nextBase,j.splice(i,1),o;return o}function E(e,t,n){return this.constructor(e,n)}function N(e,t,n,o,r){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||r?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,o)),o&&o!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=o),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===i.syncComponentUpdates&&e.base?f(e):L(e,1,r)),u(e.__ref,e))}function L(e,t,n,o){if(!e._disable){var r,a,s,u=e.props,p=e.state,d=e.context,c=e.prevProps||u,h=e.prevState||p,f=e.prevContext||d,g=e.base,y=e.nextBase,m=g||y,b=e._component,_=!1,T=f;if(e.constructor.getDerivedStateFromProps&&(p=l(l({},p),e.constructor.getDerivedStateFromProps(u,p)),e.state=p),g&&(e.props=c,e.state=h,e.context=f,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(u,p,d)?_=!0:e.componentWillUpdate&&e.componentWillUpdate(u,p,d),e.props=u,e.state=p,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!_){r=e.render(u,p,d),e.getChildContext&&(d=l(l({},d),e.getChildContext())),g&&e.getSnapshotBeforeUpdate&&(T=e.getSnapshotBeforeUpdate(c,h));var S,k,z=r&&r.nodeName;if("function"==typeof z){var j=v(r);(a=b)&&a.constructor===z&&j.key==a.__key?N(a,j,1,d,!1):(S=a,e._component=a=H(z,j,d),a.nextBase=a.nextBase||y,a._parentComponent=e,N(a,j,0,d,!1),L(a,1,n,!0)),k=a.base}else s=m,(S=b)&&(s=e._component=null),(m||1===t)&&(s&&(s._component=null),k=P(s,r,d,n||!g,m&&m.parentNode,!0));if(m&&k!==m&&a!==b){var E=m.parentNode;E&&k!==E&&(E.replaceChild(k,m),S||(m._component=null,O(m,!1)))}if(S&&M(S),e.base=k,k&&!o){for(var R=e,I=e;I=I._parentComponent;)(R=I).base=k;k._component=R,k._componentConstructor=R.constructor}}for(!g||n?C.push(e):_||(e.componentDidUpdate&&e.componentDidUpdate(c,h,T),i.afterUpdate&&i.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);w||o||x()}}function M(e){i.beforeUnmount&&i.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?M(n):t&&(null!=t.__preactattr_&&u(t.__preactattr_.ref,null),e.nextBase=t,m(t),j.push(e),z(t)),u(e.__ref,null)}function R(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function I(e,t,n){return P(n,e,{},!1,t,!1)}function V(){return{}}l(R.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=l(l({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),f(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),L(this,2)},render:function(){}});var A={h:s,createElement:s,cloneElement:d,createRef:V,Component:R,render:I,rerender:g,options:i};t.default=A},function(e,t,n){window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=!1,i="";function r(e){i=e||"",o=!0}t.enableLog=r,t.log=function(e,t,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];o&&console[e].apply(console,["["+i+"] ["+e+"]"+(t?" ["+t+"]":"")+" : "+n].concat(r))},t.enableLogIfNeeded=function(e){try{-1!==document.URL.indexOf("debugKalturaPlayer")&&r(e)}catch(e){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(0);!function(e){e.Show="show",e.Hide="hide"}(o||(o={}));var r=function(){function e(e){this.isFirstTime=!0,this.enabled=!1,this.lastHandledTime=null,this.lastHandledTimeIndex=null,this.nextTimeToHandle=null,this.cuepointChanges=[],i.log("debug","CuepointEngine:ctor","executed"),this.cuepoints=e,this.prepareCuepoint()}return e.prototype.getSnapshot=function(e){var t=this.findClosestLastIndexByTime(e);return i.log("debug","CuepointEngine:getSnapshot","create snapshot based on time "+e,{timeIndex:t}),this.createCuepointSnapshot(t)},e.prototype.updateTime=function(e,t){void 0===t&&(t=!1);var n=this.isFirstTime,o=this.lastHandledTime,r=this.nextTimeToHandle;if(0===this.cuepointChanges.length)return n&&(i.log("log","CuepointEngine:updateTime","cuepoint list empty. will always return empty snapshot"),this.isFirstTime=!1),{snapshot:[]};var a=!n&&null!==o&&null!==r&&(o>e||e-r>2e3),s=n||null!==this.lastHandledTime&&this.lastHandledTime>e||null!=this.nextTimeToHandle&&e>=this.nextTimeToHandle,l=this.findClosestLastIndexByTime(e),u=l<0?0:this.cuepointChanges[l].time;if(!s)return t?{snapshot:this.createCuepointSnapshot(l)}:{delta:this.createEmptyDelta()};if(i.log("debug","CuepointEngine:updateTime","has changes to handle. check if need to return snapshot instead of delta based on provided new time",{currentTime:e,closestChangeIndex:l,closestChangeTime:u,lastHandledTime:o,nextTimeToHandle:r,isFirstTime:n}),n||t||a){i.log("debug","CuepointEngine:updateTime","some conditions doesn't allow returning delta, return snapshot instead",{isFirstTime:n,userSeeked:a,forceSnapshot:t});var p=this.createCuepointSnapshot(l);return this.updateInternals(u,l),{snapshot:p}}var d=this.createCuepointDelta(l);return this.updateInternals(u,l),{delta:d}},e.prototype.getCurrentCuepointSnapshot=function(){return this.lastHandledTimeIndex?this.createCuepointSnapshot(this.lastHandledTimeIndex):[]},e.prototype.createCuepointSnapshot=function(e){if(!this.enabled||e<0||!this.cuepointChanges||0===this.cuepointChanges.length)return i.log("log","CuepointEngine:createCuepointSnapshot","resulted with empty snapshot",{targetIndex:e,enabled:this.enabled,cuepointCount:(this.cuepointChanges||[]).length}),[];for(var t=[],n=0;n<=e;n++){var r=this.cuepointChanges[n],a=t.indexOf(r.cuePoint);r.type===o.Show?-1===a&&t.push(r.cuePoint):-1!==a&&t.splice(a,1)}return i.log("log","CuepointEngine:createCuepointSnapshot","resulted snapshot",{snapshot:t}),t},e.prototype.createCuepointDelta=function(e){if(!this.enabled||!this.cuepointChanges||0===this.cuepointChanges.length)return i.log("log","CuepointEngine:createCuepointDelta","resulted with empty delta",{enabled:this.enabled,cuepointCount:(this.cuepointChanges||[]).length}),this.createEmptyDelta();var t=this.lastHandledTimeIndex;if(null===t)return i.log("log","CuepointEngine:createCuepointDelta","invalid internal state. resulted with empty delta"),this.createEmptyDelta();var n=[],r=[];i.log("log","CuepointEngine:createCuepointDelta","find cuepoint that were added or removed");for(var a=t+1;a<=e;a++){var s=this.cuepointChanges[a],l=n.indexOf(s.cuePoint);s.type===o.Show?-1===l&&n.push(s.cuePoint):-1!==l?(i.log("log","CuepointEngine:createCuepointDelta","cuepoint was marked with type "+s.type+" at "+s.time+". remove from new cuepoint list as it wasn't visible yet",{cuepoint:s.cuePoint}),n.splice(l,1)):-1===r.indexOf(s.cuePoint)&&(i.log("log","CuepointEngine:createCuepointDelta","cuepoint was marked with type "+s.type+" at "+s.time+". add to removed cuepoint list",{cuepoint:s.cuePoint}),r.push(s.cuePoint))}return i.log("log","CuepointEngine:createCuepointDelta","resulted delta",{newCuepoint:n,removedCuepoint:r}),{show:n,hide:r}},e.prototype.updateInternals=function(e,t){var n=this.cuepointChanges;if(n&&0!==n.length){var o=t>=n.length-1,r=null===t;this.lastHandledTime=e,this.lastHandledTimeIndex=t,this.nextTimeToHandle=r?n[0].time:o?n[n.length-1].time:n[t+1].time,this.isFirstTime=!1,i.log("debug","CuepointEngine:updateInternals","update inner state with new time and index",{lastHandledTime:this.lastHandledTime,lastHandledTimeIndex:this.lastHandledTimeIndex,nextTimeToHandle:this.nextTimeToHandle})}},e.prototype.createEmptyDelta=function(){return{show:[],hide:[]}},e.prototype.binarySearch=function(e,t){if(!e||0===e.length)return null;if(t<e[0].time)return-1;if(t>e[e.length-1].time)return e.length-1;for(var n=0,o=e.length-1;n<=o;){var i=Math.floor((o+n+1)/2);if(t<e[i].time)o=i-1;else{if(!(t>e[i].time))return i;n=i+1}}return Math.min(n,o)},e.prototype.findClosestLastIndexByTime=function(e){var t=this.cuepointChanges,n=this.binarySearch(t,e);if(null===n)return-1;for(var o=t.length;n<o-1&&t[n+1].time===e;)n++;return n},e.prototype.prepareCuepoint=function(){var e=this;(this.cuepoints||[]).forEach(function(t){null!==t.startTime&&void 0!==t.startTime&&t.startTime>=0&&e.cuepointChanges.push({time:t.startTime,type:o.Show,cuePoint:t}),null!==t.endTime&&void 0!==t.endTime&&t.endTime>=0&&e.cuepointChanges.push({time:t.endTime,type:o.Hide,cuePoint:t})}),this.cuepointChanges.sort(function(e,t){return e.time<t.time?-1:e.time===t.time?0:1}),i.log("debug","CuepointEngine:prepareCuepoint","tracking "+this.cuepointChanges.length+" changes",this.cuepointChanges)},e}();t.CuepointEngine=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scaleVideo=function(e,t,n,o,i){var r={width:0,height:0,left:0,top:0,scaleToTargetWidth:!0};if(e<=0||t<=0||n<=0||o<=0)return r;var a=n,s=t*n/e,l=e*o/t,u=o,p=l>n;return(p=p?i:!i)?(r.width=Math.abs(a),r.height=Math.abs(s),r.scaleToTargetWidth=!0):(r.width=Math.abs(l),r.height=Math.abs(u),r.scaleToTargetWidth=!1),r.left=Math.abs((n-r.width)/2),r.top=Math.abs((o-r.height)/2),r}},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(1)),o(n(4)),o(n(2)),o(n(0))},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(0),s=n(2),l=n(1);!function(e){e.Show="show",e.Hide="hide"}(r||(r={}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.playerSize=null,n.videoSize=null,n}return i(t,e),t.prototype.updateLayout=function(e,t){return this.videoSize=t,this.playerSize=e,this.recalculateCuepointLayout(),this.getCurrentCuepointSnapshot()},t.prototype._calculateLayout=function(e,t){var n=e.rawLayout;return{x:t.left+n.relativeX*t.width,y:t.top+n.relativeY*t.height,width:n.relativeWidth*t.width,height:n.relativeHeight*t.height}},t.prototype.recalculateCuepointLayout=function(){var e=this;if(a.log("debug","CuepointLayoutEngine::recalculateCuepointLayout","calculating cuepoint layout based on video/player sizes"),!this.playerSize||!this.videoSize)return a.log("debug","CuepointLayoutEngine::recalculateCuepointLayout","missing video/player sizes, hide all cuepoint"),void(this.enabled=!1);var t=this.playerSize,n=t.width,o=t.height,i=this.videoSize,r=i.width,l=i.height;if(!(n&&o&&r&&l))return a.log("debug","CuepointLayoutEngine::recalculateCuepointLayout","missing video/player sizes, hide all cuepoint"),void(this.enabled=!1);var u=s.scaleVideo(r,l,n,o,!0);a.log("debug","CuepointLayoutEngine::recalculateCuepointLayout","recalculate cuepoint layout based on new sizes",u),(this.cuepoints||[]).forEach(function(t){t.layout=e._calculateLayout(t,u)}),this.enabled=!0},t}(l.CuepointEngine);t.CuepointLayoutEngine=u}])},function(e,t,n){"use strict";t.__esModule=!0,n(3)},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&(n[o[i]]=e[o[i]])}return n};t.__esModule=!0;var r=n(0),a=n(4),s=n(1),l=n(6);!function(e,t){function n(){return-1!=navigator.userAgent.indexOf("iPhone")&&!(-1!=navigator.userAgent.indexOf("iPad"))}s.enableLogIfNeeded("hotspots"),e.kalturaPluginWrapper(function(){e.PluginManager.add("hotspots",e.KBaseComponent.extend({_hotspots:[],_root:null,_videoSize:null,_wasPlayed:!1,stage:null,defaultConfig:{parent:"videoHolder",order:1},handleVideoSizeChange:function(e){var t=this.getPlayer().evaluate("{mediaProxy.entry}"),n=t.width,o=t.height;s.log("debug","plugin::handleVideoSizeChange","use entry size provided by player to calculate actual stage size",{width:n,height:o}),this._videoSize=n&&o?{width:n,height:o}:null,this.renderRoot(!0)},setup:function(){n()?s.log("log","plugin::setup","iphone detected, disable plugin"):this.addBindings()},pauseVideo:function(){this.getPlayer().sendNotification("doPause")},seekTo:function(e){this.getPlayer().seek(e)},getCuePoints:function(){return this.cuePoints},loadCuePoints:function(){var e=this;this.getKalturaClient().doRequest({service:"cuepoint_cuepoint",action:"list","filter:entryIdEqual":this.getPlayer().kentryid,"filter:objectType":"KalturaCuePointFilter","filter:cuePointTypeEqual":"annotation.Annotation","filter:tagsLike":"hotspots"},function(t){!t||t.code?console.warn("failed to load hotspots with code '"+(t.code||"failure")+"'"):(e._hotspots=l.convertToHotspots(t),e.renderRoot(!1))})},getPlayerSize:function(){var e=this.getPlayer().getVideoHolder();return e?{width:e.width(),height:e.height()}:null},sendAnalytics:function(e){try{var t=this.getPlayer().plugins.kAnalony;if(!t)return void s.log("warn","plugin::sendAnalytics","cannot send analytics event, missing kAnalony plugin",e);var n=e.eventNumber,o=i(e,["eventNumber"]);t.sendAnalytics(n,o)}catch(t){s.log("error","plugin::sendAnalytics","cannot send analytics event with error '"+t.message+"'",e)}},getVideoSize:function(){return this._videoSize?o({},this._videoSize):null},_onRootResized:function(){this.renderRoot(!1)},renderRoot:function(e){var t=this,n={hotspots:this._hotspots,currentTime:this._getCurrentTime(),shouldHandleResize:e,onResize:this._onRootResized.bind(this),getPlayerSize:this.getPlayerSize.bind(this),getVideoSize:this.getVideoSize.bind(this),pauseVideo:this.pauseVideo.bind(this),seekTo:this.seekTo.bind(this),sendAnalytics:this.sendAnalytics.bind(this)},i=this.getComponent()[0];this._root||s.log("debug","plugin::renderStage","create root component",{parentElement:i,root:this._root}),this._root=r.render(r.h(a.default,o({},n,{ref:function(e){return t.stage=e}})),i,this._root)},addBindings:function(){var e=this;this.bind("updateLayout",function(){s.log("debug","plugin::bind(updateLayout)","invoked"),e.renderRoot(!0)}),this.bind("firstPlay",function(){s.log("debug","plugin::bind(firstPlay)","invoked"),e._wasPlayed||(e.renderRoot(!1),e._wasPlayed=!0)}),this.bind("seeked",function(){s.log("debug","plugin::bind(seeked)","invoked"),e._wasPlayed||(e.renderRoot(!1),e._wasPlayed=!0)}),this.bind("onChangeMedia",function(){s.log("debug","plugin::bind(onChangeMedia)","invoked"),e._wasPlayed=!1,e._videoSize=null,e._hotspots=[];var t=jQuery('[id="hotspotsOverlay"]')[0];r.render(r.h(null),t,e._root),e._root=null,e.stage=null}),this.bind("monitorEvent",function(){e.renderRoot(!1)}),this.bind("mediaLoaded",function(){e.loadCuePoints(),e.handleVideoSizeChange()}),this.bind("seeked",function(){e.renderRoot(!1)})},_getCurrentTime:function(){return 1e3*this.getPlayer().currentTime},getComponent:function(){return this.$el||(this.$el=jQuery("<div></div>").attr("id","hotspotsOverlay").css({position:"absolute",height:"0",width:"0",top:0,left:0,overflow:"visible","z-index":"2"})),this.$el}}))})}(window.mw,window.jQuery)},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};t.__esModule=!0;var a=n(0),s=n(5),l=n(1),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.engine=null,t.initialState={playerSize:t.props.getPlayerSize(),videoSize:t.props.getVideoSize(),visibleHotspots:[]},t.state=r({},t.initialState),t.handleResize=function(){var e=t.props,n=e.getPlayerSize,o=e.getVideoSize,i=e.onResize;t.props.shouldHandleResize&&t.setState({playerSize:n(),videoSize:o()},function(){t.engine&&(t.engine.updateLayout(t.state.playerSize,t.state.videoSize),t.syncVisibleHotspots(!0)),i()})},t.reset=function(){t.engine=null,t.setState(r({},t.initialState))},t.renderHotspots=function(e){if(!e)return null;var n=t.props,o=n.seekTo,i=n.pauseVideo,r=n.sendAnalytics;return e.map(function(e){return a.h(s.default,{pauseVideo:i,seekTo:o,key:e.id,visible:!0,hotspot:e,sendAnalytics:r})})},t}return i(t,e),t.prototype.componentDidUpdate=function(e,t,n){e.hotspots!==this.props.hotspots&&this._createEngine(),e.currentTime!==this.props.currentTime&&this.syncVisibleHotspots(),e.shouldHandleResize!==this.props.shouldHandleResize&&this.handleResize()},t.prototype._createEngine=function(){var e=this.props.hotspots;e&&0!==e.length?(this.engine=new l.CuepointLayoutEngine(e),this.engine.updateLayout(this.state.playerSize,this.state.videoSize)):this.engine=null},t.prototype.componentDidMount=function(){this.reset(),this._createEngine()},t.prototype.syncVisibleHotspots=function(e){var t=this;void 0===e&&(e=!1);var n=this.props.currentTime;this.setState(function(o){if(!t.engine)return{visibleHotspots:[]};var i=t.engine.updateTime(n,e);if(i.snapshot)return{visibleHotspots:i.snapshot};if(!i.delta)return{visibleHotspots:[]};var r=i.delta,a=r.show,s=r.hide;if(0!==a.length||0!==s.length){var l=o.visibleHotspots;return a.forEach(function(e){-1===l.indexOf(e)&&l.push(e)}),s.forEach(function(e){var t=l.indexOf(e);-1!==t&&l.splice(t,1)}),{visibleHotspots:l}}})},t.prototype.render=function(){var e=this.state.visibleHotspots,t=this.renderHotspots(e);return a.h("div",{style:{position:"absolute",display:"block",overflow:"visible",top:0,left:0,width:0,height:0}},t)},t}(a.Component);t.default=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};t.__esModule=!0;var a=n(0),s={position:"absolute",display:"table",boxSizing:"border-box"},l={position:"relative",width:"100%",height:"100%",appearance:"none",border:"none",display:"table-cell",verticalAlign:"middle",textAlign:"center",cursor:"pointer",wordBreak:"break-all",textRendering:"geometricPrecision"},u={styles:{}};function p(e){return e.match(/^https?:\/\//i)||(e="http://"+e),e}var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={disableClick:!0,isReady:!1},t.handleKeyUp=function(e){13===e.keyCode&&t.handleClick()},t.isClickable=function(){var e=t.props.hotspot.onClick;if(!e)return!1;switch(e.type){case"jumpToTime":return void 0!==e.jumpToTime;case"openUrl":case"openUrlInNewTab":return!!e.url;default:return!1}},t.handleClick=function(){var e=t.props.hotspot,n=t.state.disableClick;if(e.onClick&&!n)switch(e.onClick.type){case"jumpToTime":if(void 0===e.onClick.jumpToTime)return;t.props.seekTo(e.onClick.jumpToTime/1e3);break;case"openUrl":if(!e.onClick.url)return;var o=p(e.onClick.url);window.open(o,"_top"),t.props.sendAnalytics({eventNumber:47,target:o,hotspotId:e.id});break;case"openUrlInNewTab":if(!e.onClick.url)return;t.props.pauseVideo();o=p(e.onClick.url);try{window.open(o,"_blank"),t.props.sendAnalytics({eventNumber:47,target:o,hotspotId:e.id})}catch(e){}}},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this.props.hotspot;if(e&&e.onClick){var t=e.onClick,n=t.type,o=t.url;!n||!o||0==n.length||o.length;this.setState({isReady:!0,disableClick:!this.isClickable()})}else this.setState({isReady:!0})},t.prototype.render=function(){var e=this.props.hotspot,t=e.layout,n=e.label,o=this.state,i=o.isReady,u=o.disableClick;if(!i||!this.props.visible)return null;var p=r({},s,{top:t.y,left:t.x,height:t.height,width:t.width}),d=r({},l,e.styles,{cursor:u?"default":"pointer"});return a.h("div",{onClick:this.handleClick,onKeyUp:this.handleKeyUp,tabIndex:0,"aria-label":n,"aria-disabled":u,role:"button",style:p},a.h("div",{style:d},n))},t.defaultProps=u,t}(a.Component);t.default=d},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};t.__esModule=!0,t.convertToHotspots=function(e){var t=[];return(e.objects||[]).forEach(function(e){var n=function(e,t){if(void 0===t&&(t={}),!e)return t;try{return{result:JSON.parse(e)}}catch(e){return{error:e}}}(e.partnerData),i=n.result;if(n.error,i&&i.schemaVersion){var r=o({},i.layout);t.push({id:e.id,startTime:e.startTime,endTime:e.endTime,label:e.text,styles:i.styles,onClick:i.onClick,rawLayout:r})}}),t}}])});
//# sourceMappingURL=playkit-js-hotspots.js.map