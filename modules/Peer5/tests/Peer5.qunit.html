<!DOCTYPE HTML>
<html>
<head>
    <title>Peer 5 Sample page</title>
    <script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
    <script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
    <script type="text/javascript" src="../../../docs/js/doc-bootstrap.js"></script>
    <script type="text/javascript">
        function jsKalturaPlayerTest(videoId) {
            // Name this module
            module("Peer 5 Sample");

            asyncTest("Target bitrate", function () {
                kalturaQunitWaitForPlayer(function () {
                    // check if the source was selected ( html5 only test for now )
                    var $iframe = $('#' + videoId + '_ifp').contents();
                    // TODO what is the api to get the current flavor?

                    // reach into the iframe grab the mediaElement:
                    var source = $iframe.find('#' + videoId)[0].getSource();
                    // FIXME add more webm flavors to chouse from!
                    if (source.mimeType == 'video/webm' && source.bandwidth == 690176) {
                        // selected the single webm flavor
                        ok(true, "Single webm flavor selected");
                    } else {
                        // check if the browser supports adaptive and instead check for preferedFlavorBR
                        var vndSources = $iframe.find('#' + videoId)[0].mediaElement.getPlayableSources('application/vnd.apple.mpegurl');
                        if (vndSources.length) {
                            for (var i = 0; i < vndSources.length; i++) {
                                notEqual(vndSources[i].src.indexOf('preferedFlavorBR'), -1, "preferedFlavorBR param found in adaptive source URL:\n" + vndSources[i].src);
                            }
                        } else {
                            // make sure the chrome, IE, safari select the correct h.264 flavor bitrate:
                            equal(source.bandwidth, 429056, "target bitrate selected");
                        }
                    }
                    start();
                });
            });

        }
    </script>
    <script>
        function jsCallbackReady(videoId) {
            if (console && console.log) {
                console.log('jsCallbackReady: ' + videoId);
            }
        }
    </script>

    <!-- qunit-kaltura must come after qunit-bootstrap.js and after mwEmbedLoader.php and after any jsCallbackReady stuff-->
    <script type="text/javascript" src="../../KalturaSupport/tests/resources/qunit-kaltura-bootstrap.js"></script>
</head>
<body>
<h2> Peer 5 Sample page </h2>

<div id="flavorConfig"></div>
<br/>

<div id="player1" style="width:834px;height:500px;float:left">
</div>
<script>

    kWidget.featureConfig({
        'targetId':'player1',
        "wid":"_1375472",
        //'wid': '_243342',
        'uiconf_id':'12752942',
        //'uiconf_id' : '2877502',
//        'entry_id':'0_zy98vx2o',
        'entry_id':'0_9qw3jb7i',
        'LeadWithHTML5':true,
        'flashvars':{
            'peer5':{
                'plugin':true,
                'peer5libUrl': 'http://t.peer5.com/peer5.js?id=i1ZwiAZ4edjF9_WyJffX'
//                'url':'http://commondatastorage.googleapis.com/peer5_vod/wind2.mp4',
//                'type':'video/mp4; codecs="avc1.64001f,mp4a.40.2"'


            }
        }
    });
</script>
<div style="clear:both"></div>
<br>

</body>
</html>